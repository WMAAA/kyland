{"layout":"logicalStructure","root":{"data":{"text":"<p>SC回环检测</p>","expand":true,"richText":true,"isActive":false,"uid":"6bfe509b-d041-4e67-a2c1-c369ab723823"},"children":[{"data":{"text":"<p><strong>process_pg</strong></p>","uid":"ab7c19c3-42db-4f32-97c2-5e5166a0eef6","expand":true,"richText":true,"isActive":false,"fillColor":"#16A5A5"},"children":[{"data":{"text":"<p>循环</p>","uid":"999858a0-f2d4-4d61-948f-4cabab9dd356","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>只要odometryBuf</p><p>和fullResBuf有数据就一直循环</p><p>打开互斥锁mBuf</p>","uid":"160e8685-2a42-4ec7-a787-c385e1b295fc","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>从缓冲区取数据</p>","uid":"8ef488f8-8b5e-46b5-9a20-7cf323b1d53a","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>lidar消息到pcl点云</p>","expand":true,"richText":true,"isActive":false,"uid":"e330cb9d-7dea-4c4d-b61f-df14a73fe36e"},"children":[]},{"data":{"text":"<p>getOdom函数获取Pose6D</p>","expand":true,"richText":true,"isActive":false,"uid":"ca025ace-ceb9-408d-9e63-d0bfd0e52aca"},"children":[]},{"data":{"text":"<p>diffTransformation函数计算两个6D位姿之间的差别</p>","expand":true,"richText":true,"isActive":false,"uid":"d4573b50-6d46-4764-be58-0f9fcb4dba23"},"children":[]},{"data":{"text":"<p>累积位移，累积旋转，超过阈值，认为是新的关键帧，否则continue</p>","expand":true,"richText":true,"isActive":false,"uid":"9c8f1ecd-4c5e-4586-8f12-3ccb72a562c1","borderColor":"#F44E3B"},"children":[]},{"data":{"text":"<p>加锁</p>","expand":true,"richText":true,"isActive":false,"uid":"95e28826-5ec4-4813-922c-3b8885934ec4"},"children":[{"data":{"text":"<p>pcl::VoxelGrid下采样后，保存<strong>keyframe</strong>相关数据，</p>","expand":true,"richText":true,"isActive":false,"uid":"127b005e-101b-4108-8fac-b8696e71fc3b"},"children":[]},{"data":{"text":"<p><strong>scManager.makeAndSaveScancontextAndKeys(*thisKeyFrameDS);</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"f6bb5868-9dd2-48d6-ae9b-26021a322a34","borderColor":"#F44E3B"},"children":[]}]},{"data":{"text":"<p><strong>gtSAMgraphMade</strong>判断是不是第一次建位姿图</p>","expand":true,"richText":true,"isActive":false,"uid":"4e2665a0-6e3c-4d19-820d-7b8d36fb5baf"},"children":[{"data":{"text":"<p>第一次</p>","uid":"9cd14247-5f7e-43ee-99ae-5ac89bd15db1","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p><strong>加锁mtxPosegraph，</strong>然后添加prior因子</p>","uid":"e2dcb334-8a58-40ae-9079-b0703503b1e4","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>标记gtSAMgraphMade = true</p>","expand":true,"richText":true,"isActive":false,"uid":"b3bbdb04-7a86-4d10-83ba-d49934b6b294"},"children":[]}]},{"data":{"text":"<p>否则</p>","uid":"8c8e27c8-041a-4132-9dc3-68a366afd3f6","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p><strong>加锁mtxPosegraph，</strong>图中加pose因子</p>","uid":"494a468b-1746-46af-8256-18cc8cabd286","expand":true,"richText":true,"isActive":false,"associativeLineTargets":["508a782d-b360-4092-bef6-b22d699f4c22"],"associativeLineTargetControlOffsets":[[{"x":278.9407795353527,"y":132.5000000000004},{"x":213.74602114769118,"y":-149.24999999999977}]],"associativeLinePoint":[{"startPoint":{"x":2380.3092204646478,"y":-94.5,"dir":"bottom","range":-29.30922046464756},"endPoint":{"x":1838.0039788523093,"y":1403.5,"dir":"top","range":-21.50397885230937}}]},"children":[]},{"data":{"text":"<p>100个输出一次</p>","expand":true,"richText":true,"isActive":false,"uid":"fd3b1c3d-4854-4a1b-83d2-4c0c9e62032c"},"children":[]}]}]},{"data":{"text":"<p>保存当前点云和时间</p>","expand":true,"richText":true,"isActive":false,"uid":"482ec10f-0f98-4910-b06b-ef5de62d869c","borderColor":"#F44E3B"},"children":[]}]}]},{"data":{"text":"<p>2ms的等待</p>","generalization":null,"richText":true,"expand":true,"isActive":false,"uid":"5d177f65-a3bb-4329-ab3c-e6b3301d5acf"},"children":[]}]},{"data":{"text":"<p><strong>process_lcd</strong></p>","uid":"abcf5cc5-18c8-4736-8a48-514c09a6621d","expand":true,"richText":true,"isActive":false,"fillColor":"#16A5A5"},"children":[{"data":{"text":"<p>1hz的ros::Rate</p>","uid":"04ab6f2f-1835-4952-bca5-30ea89451120","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>while (ros::ok())</p>","expand":true,"richText":true,"isActive":false,"uid":"a2ea1c13-4ad9-4403-af0d-5deea6ad22bf"},"children":[{"data":{"text":"<p>rate.sleep();</p>","uid":"56739279-8d33-49b0-9126-6e7dc2a57865","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p><strong>performSCLoopClosure执行扫描上下文闭环检测</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"3416ea56-44b8-4932-9a27-a48e4bb5cabc","borderColor":"#F44E3B","associativeLineTargets":["d61ad3e4-2047-4e4e-975c-5ba3bed71612"],"associativeLineTargetControlOffsets":[[{"x":-122.5,"y":0},{"x":8.134977843127444,"y":-72.13095238095207}]],"associativeLinePoint":[{"startPoint":{"x":1537,"y":407.5,"dir":"left"},"endPoint":{"x":1309.4126412044927,"y":301,"dir":"top","range":-17.41264120449272}}]},"children":[]}]}]},{"data":{"text":"<p><strong>performSCLoopClosure</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"d61ad3e4-2047-4e4e-975c-5ba3bed71612","fontFamily":"微软雅黑, Microsoft YaHei","fontSize":18,"fontWeight":"normal","fontStyle":"normal","textDecoration":"none","color":"#fff","paddingX":15,"paddingY":5,"shape":"rectangle","borderWidth":2,"borderRadius":10,"gradientStyle":false,"startColor":"#549688","endColor":"#fff","startDir":[0,0],"endDir":[1,0],"fillColor":"#16A5A5","borderColor":"rgb(30, 53, 86)","borderDasharray":"none","hoverRectColor":"","hoverRectRadius":5,"lineColor":"rgb(30, 53, 86)","lineDasharray":"none","lineWidth":2,"lineMarkerDir":"end","lineFlow":false,"lineFlowForward":true,"lineFlowDuration":1},"children":[{"data":{"text":"<p>关键帧数目小于排除的最近关键帧数，提前返回，不进行闭环检测</p>","uid":"b492b037-7975-42ab-8861-7a8a9411623b","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>检测闭环</p><p><strong> auto detectResult = scManager.detectLoopClosureID(); </strong></p>","expand":true,"richText":true,"isActive":false,"uid":"8746381d-af25-4e0b-be94-c0876fc96c42","borderColor":"#F44E3B"},"children":[]},{"data":{"text":"<p>最近的历史帧 <strong>int SCclosestHistoryFrameID = detectResult.first;</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"0f55368c-aefc-434a-8109-374b709f8772"},"children":[]},{"data":{"text":"<p><strong>mBuf</strong>加锁</p>","expand":true,"richText":true,"isActive":false,"uid":"33a1720e-ee14-4d53-9480-b144f1a394a8"},"children":[{"data":{"text":"<p><strong>scLoopICPBuf.push添加了一个pair</strong></p>","uid":"ad8ce2ac-75db-4c4a-acb6-c5333afece10","expand":true,"richText":true,"isActive":false,"borderColor":"#F44E3B","associativeLineTargets":["b760afe4-e537-4398-bb1d-9c8d9de4df1e"],"associativeLineTargetControlOffsets":[[{"x":-37.91237492888922,"y":-1.0595238095235118},{"x":-2.359420373461262,"y":-55.20238095238062}]],"associativeLinePoint":[{"startPoint":{"x":1716.1742796907954,"y":418.5,"dir":"bottom","range":11.825720309204703},"endPoint":{"x":1633.4784679925103,"y":595.5,"dir":"top","range":-14.478467992510287}}]},"children":[]}]}]},{"data":{"text":"<p><strong>process_icp</strong></p>","expand":true,"richText":true,"isActive":false,"fontFamily":"微软雅黑, Microsoft YaHei","fontSize":18,"fontWeight":"normal","fontStyle":"normal","textDecoration":"none","color":"#fff","paddingX":15,"paddingY":5,"shape":"rectangle","borderWidth":2,"borderRadius":10,"gradientStyle":false,"startColor":"#549688","endColor":"#fff","startDir":[0,0],"endDir":[1,0],"fillColor":"#16A5A5","borderColor":"rgb(30, 53, 86)","borderDasharray":"none","hoverRectColor":"","hoverRectRadius":5,"lineColor":"rgb(30, 53, 86)","lineDasharray":"none","lineWidth":2,"lineMarkerDir":"end","lineFlow":false,"lineFlowForward":true,"lineFlowDuration":1,"uid":"5b4b90fa-b9ae-4455-9f3d-a2b56a74cc8d"},"children":[{"data":{"text":"<p>while循环</p>","uid":"0dd614e9-aa68-48f9-a936-6a9680254b26","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p><strong>while&nbsp;&nbsp;scLoopICPBuf队列不为空</strong></p>","uid":"b760afe4-e537-4398-bb1d-9c8d9de4df1e","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p>队列元素太多，提示一下</p>","uid":"b4216dc3-7e3c-4083-84f1-f2611f5eaacb","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>加锁<strong>mBuf</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"3214ea3a-caff-4f41-a5d0-08c4db878d07"},"children":[{"data":{"text":"<p>取元素</p>","uid":"eb99fe75-6211-4862-9a34-9204df3557d6","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p><strong>pop</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"a59f1bf5-e6d7-49af-82ad-c79b9d08a006"},"children":[]}]},{"data":{"text":"<p><strong>doICPVirtualRelative传入两帧索引</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"11e70ca2-f9cf-41d7-84f0-8759a69144c3","borderColor":"#F44E3B","associativeLineTargets":["cafc6055-38c4-4a6d-973f-6b599958a1a2"],"associativeLineTargetControlOffsets":[[{"x":-252.5,"y":0},{"x":29.30047400636613,"y":-92.05952380952351}]],"associativeLinePoint":[{"startPoint":{"x":1788,"y":635.5,"dir":"left"},"endPoint":{"x":1301.104287898397,"y":869.5,"dir":"top","range":-18.104287898396922}}]},"children":[]},{"data":{"text":"<p>ICP有结果</p>","expand":true,"richText":true,"isActive":false,"uid":"a78ad67e-18c7-43e5-9857-a190caa7dd44"},"children":[{"data":{"text":"<p>获取相对位姿</p>","uid":"5a8c94a9-b9f6-418d-9549-1f09f0985816","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p><strong>mtxPosegraph</strong>加锁</p>","expand":false,"richText":true,"isActive":false,"uid":"e92efef5-5064-486a-b6ac-b2f8fe653a59"},"children":[{"data":{"text":"<p>gtSAMgraph.add(gtsam::BetweenFactor&lt;gtsam::Pose3&gt;(prev_node_idx, curr_node_idx, relative_pose, robustLoopNoise));</p>","uid":"9867cc0e-e41d-4a2d-8a37-0c0906619a5c","expand":true,"richText":true,"isActive":false},"children":[]}]}]}]},{"data":{"text":"<p>每次循环结束</p><p>std休眠2ms</p>","uid":"4951f210-e557-429f-8c89-efb730fd2c32","expand":true,"richText":true,"isActive":false},"children":[]}]}]},{"data":{"text":"<p><strong>doICPVirtualRelative</strong></p>","expand":true,"richText":true,"isActive":false,"fontFamily":"微软雅黑, Microsoft YaHei","fontSize":18,"fontWeight":"normal","fontStyle":"normal","textDecoration":"none","color":"#fff","paddingX":15,"paddingY":5,"shape":"rectangle","borderWidth":2,"borderRadius":10,"gradientStyle":false,"startColor":"#549688","endColor":"#fff","startDir":[0,0],"endDir":[1,0],"fillColor":"#16A5A5","borderColor":"rgb(30, 53, 86)","borderDasharray":"none","hoverRectColor":"","hoverRectRadius":5,"lineColor":"rgb(30, 53, 86)","lineDasharray":"none","lineWidth":2,"lineMarkerDir":"end","lineFlow":false,"lineFlowForward":true,"lineFlowDuration":1,"uid":"cafc6055-38c4-4a6d-973f-6b599958a1a2"},"children":[{"data":{"text":"<p>关键帧搜索范围historyKeyframeSearchNum</p>","uid":"ee8758ec-bb0b-4cdb-b0e8-ccbef838b383","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p><strong>loopFindNearKeyframesCloud</strong></p><p><strong>提取当前关键帧和目标关键帧的点云。</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"b13c1ad6-5a69-4b0c-839c-278aa94c204c"},"children":[]},{"data":{"text":"<p>发布点云</p>","expand":true,"richText":true,"isActive":false,"uid":"3478c44e-d23d-4529-b8c7-039aa23aaeaf"},"children":[]},{"data":{"text":"<p><strong>pcl::IterativeClosestPoint&lt;PointType, PointType&gt; icp;</strong></p><p><strong>icp相关参数设置，不使用RANSAC，使用有啥情况？</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"4ebe6dd1-d134-43f9-8baa-57bb0b4e5315"},"children":[]},{"data":{"text":"<p>icp设置源和目标点云，<strong>icp.align(*unused_result);</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"1d099bbd-5e72-4bd6-8dc3-5db00b41cd54"},"children":[]},{"data":{"text":"<p>获取<strong>correctionLidarFrame = icp.getFinalTransformation();</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"33709ffa-5b31-493c-bebe-46c6ba3c6562"},"children":[]},{"data":{"text":"<p>返回相对位姿变换，<strong>poseFrom.between(poseTo);</strong></p>","expand":true,"richText":true,"isActive":false,"uid":"333f9162-1c07-474b-b642-064c1598f136"},"children":[]}]},{"data":{"text":"<p><strong>process_isam</strong></p>","expand":true,"richText":true,"isActive":false,"fontFamily":"微软雅黑, Microsoft YaHei","fontSize":18,"fontWeight":"normal","fontStyle":"normal","textDecoration":"none","color":"#fff","paddingX":15,"paddingY":5,"shape":"rectangle","borderWidth":2,"borderRadius":10,"gradientStyle":false,"startColor":"#549688","endColor":"#fff","startDir":[0,0],"endDir":[1,0],"fillColor":"#16A5A5","borderColor":"rgb(30, 53, 86)","borderDasharray":"none","hoverRectColor":"","hoverRectRadius":5,"lineColor":"rgb(30, 53, 86)","lineDasharray":"none","lineWidth":2,"lineMarkerDir":"end","lineFlow":false,"lineFlowForward":true,"lineFlowDuration":1,"uid":"324a4c8a-bb5c-48d7-86ff-3baa64de3818"},"children":[{"data":{"text":"<p><strong>ros::Rate&nbsp;&nbsp;1Hz</strong></p>","uid":"d8c3caa6-19bd-49a7-a946-6dd0f427da74","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>while (ros::ok())</p>","expand":true,"richText":true,"isActive":false,"uid":"4ac13de0-ced7-4681-a5f3-2cb89b6be1a6"},"children":[{"data":{"text":"<p><strong>mtxPosegraph加锁</strong></p>","uid":"802e32b0-d735-4823-b9e3-600169906f81","expand":true,"richText":true,"isActive":false},"children":[{"data":{"text":"<p><strong>runISAM2opt();</strong></p>","uid":"508a782d-b360-4092-bef6-b22d699f4c22","expand":true,"richText":true,"isActive":false,"borderColor":"#F44E3B"},"children":[]}]},{"data":{"text":"<p>saveOptimizedVerticesKITTIformat</p>","uid":"991c6f7f-7fb5-4ea5-abbb-6304c7a4a88b","expand":true,"richText":true,"isActive":false},"children":[]},{"data":{"text":"<p>saveOdometryVerticesKITTIformat</p>","uid":"31f16e4d-a1cc-4ac2-8ad0-852572a970c2","expand":true,"richText":true,"isActive":false},"children":[]}]}]}],"smmVersion":"0.13.0"},"theme":{"template":"classic4","config":{}},"view":{"transform":{"scaleX":0.6000000000000001,"scaleY":0.6000000000000001,"shear":0,"rotate":0,"translateX":-231.80000000000075,"translateY":385.7,"originX":0,"originY":0,"a":0.6000000000000001,"b":0,"c":0,"d":0.6000000000000001,"e":-231.80000000000075,"f":385.7},"state":{"scale":0.6000000000000001,"x":-231.80000000000075,"y":385.7,"sx":217.19999999999976,"sy":136.19999999999996}}}